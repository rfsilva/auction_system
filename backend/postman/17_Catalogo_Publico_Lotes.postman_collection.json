{
	"info": {
		"_postman_id": "public-catalog-collection-id",
		"name": "17 - Catálogo Público de Lotes",
		"description": "Collection para acesso público ao catálogo de lotes e produtos em leilão.\n\n**Funcionalidades cobertas:**\n- Listar lotes ativos\n- Visualizar detalhes de lote\n- Listar produtos de um lote\n- Buscar produtos por categoria\n- Filtrar por preço e status\n- Visualizar histórico de lances\n- Obter estatísticas públicas\n\n**Produtos disponíveis:**\n- Samsung Galaxy S23 Ultra (Eletrônicos)\n- iPhone 13 Pro (Eletrônicos)\n- Guitarra Fender Stratocaster (Instrumentos)\n- Dom Casmurro 1ª Edição (Livros)\n- Vaso de Cerâmica (Decoração)\n\n**Não requer autenticação**",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Listar Lotes Ativos",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has active lots\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data).to.be.an('array');",
							"});",
							"",
							"pm.test(\"All lots are ACTIVE\", function () {",
							"    const jsonData = pm.response.json();",
							"    jsonData.data.forEach(lote => {",
							"        pm.expect(lote.status).to.equal('ACTIVE');",
							"    });",
							"});",
							"",
							"pm.test(\"Lots have required public fields\", function () {",
							"    const jsonData = pm.response.json();",
							"    if (jsonData.data.length > 0) {",
							"        const firstLot = jsonData.data[0];",
							"        pm.expect(firstLot).to.have.property('id');",
							"        pm.expect(firstLot).to.have.property('title');",
							"        pm.expect(firstLot).to.have.property('description');",
							"        pm.expect(firstLot).to.have.property('lote_end_datetime');",
							"        pm.expect(firstLot).to.have.property('produtos_count');",
							"        pm.expect(firstLot).to.have.property('seller_name');",
							"        // Não deve expor dados sensíveis",
							"        pm.expect(firstLot).to.not.have.property('seller_id');",
							"        pm.expect(firstLot).to.not.have.property('contract_id');",
							"    }",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/public/lotes",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"public",
						"lotes"
					]
				},
				"description": "Lista todos os lotes ativos disponíveis para visualização pública."
			}
		},
		{
			"name": "Visualizar Detalhes do Lote",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Lot details complete\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data).to.have.property('id');",
							"    pm.expect(jsonData.data).to.have.property('title');",
							"    pm.expect(jsonData.data).to.have.property('description');",
							"    pm.expect(jsonData.data).to.have.property('produtos');",
							"    pm.expect(jsonData.data).to.have.property('seller_info');",
							"    pm.expect(jsonData.data.produtos).to.be.an('array');",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"// ID de lote de teste",
							"pm.environment.set('testLoteId', '880e8400-e29b-41d4-a716-446655440010');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/public/lotes/{{testLoteId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"public",
						"lotes",
						"{{testLoteId}}"
					]
				},
				"description": "Visualiza detalhes completos de um lote específico."
			}
		},
		{
			"name": "Listar Todos os Produtos Ativos",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has active products\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data).to.be.an('array');",
							"});",
							"",
							"pm.test(\"All products are ACTIVE\", function () {",
							"    const jsonData = pm.response.json();",
							"    jsonData.data.forEach(produto => {",
							"        pm.expect(produto.status).to.equal('ACTIVE');",
							"    });",
							"});",
							"",
							"pm.test(\"Products have public fields only\", function () {",
							"    const jsonData = pm.response.json();",
							"    if (jsonData.data.length > 0) {",
							"        const firstProduct = jsonData.data[0];",
							"        pm.expect(firstProduct).to.have.property('id');",
							"        pm.expect(firstProduct).to.have.property('title');",
							"        pm.expect(firstProduct).to.have.property('current_price');",
							"        pm.expect(firstProduct).to.have.property('end_datetime');",
							"        pm.expect(firstProduct).to.have.property('categoria');",
							"        pm.expect(firstProduct).to.have.property('images');",
							"        pm.expect(firstProduct).to.have.property('seller_name');",
							"        pm.expect(firstProduct).to.have.property('total_bids');",
							"        // Não deve expor dados sensíveis",
							"        pm.expect(firstProduct).to.not.have.property('seller_id');",
							"        pm.expect(firstProduct).to.not.have.property('reserve_price');",
							"    }",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/public/produtos?page=0&size=20",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"public",
						"produtos"
					],
					"query": [
						{
							"key": "page",
							"value": "0"
						},
						{
							"key": "size",
							"value": "20"
						}
					]
				},
				"description": "Lista todos os produtos ativos com paginação."
			}
		},
		{
			"name": "Buscar Produtos por Categoria",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"All products are from Eletrônicos category\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.success).to.be.true;",
							"    jsonData.data.forEach(produto => {",
							"        pm.expect(produto.categoria).to.equal('Eletrônicos');",
							"    });",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/public/produtos?categoria=Eletrônicos",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"public",
						"produtos"
					],
					"query": [
						{
							"key": "categoria",
							"value": "Eletrônicos"
						}
					]
				},
				"description": "Busca produtos por categoria específica."
			}
		},
		{
			"name": "Filtrar Produtos por Faixa de Preço",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"All products within price range\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.success).to.be.true;",
							"    ",
							"    const minPrice = 1000;",
							"    const maxPrice = 5000;",
							"    ",
							"    jsonData.data.forEach(produto => {",
							"        pm.expect(produto.current_price).to.be.at.least(minPrice);",
							"        pm.expect(produto.current_price).to.be.at.most(maxPrice);",
							"    });",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/public/produtos?min_price=1000&max_price=5000",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"public",
						"produtos"
					],
					"query": [
						{
							"key": "min_price",
							"value": "1000"
						},
						{
							"key": "max_price",
							"value": "5000"
						}
					]
				},
				"description": "Filtra produtos por faixa de preço."
			}
		},
		{
			"name": "Buscar Produtos por Texto",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Search results contain Samsung\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.success).to.be.true;",
							"    ",
							"    jsonData.data.forEach(produto => {",
							"        const titleLower = produto.title.toLowerCase();",
							"        const descLower = produto.description ? produto.description.toLowerCase() : '';",
							"        const searchTerm = 'samsung';",
							"        ",
							"        const containsSearch = titleLower.includes(searchTerm) || descLower.includes(searchTerm);",
							"        pm.expect(containsSearch).to.be.true;",
							"    });",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/public/produtos?search=Samsung",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"public",
						"produtos"
					],
					"query": [
						{
							"key": "search",
							"value": "Samsung"
						}
					]
				},
				"description": "Busca produtos por texto no título ou descrição."
			}
		},
		{
			"name": "Visualizar Detalhes do Produto",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Product details complete\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data).to.have.property('id');",
							"    pm.expect(jsonData.data).to.have.property('title');",
							"    pm.expect(jsonData.data).to.have.property('description');",
							"    pm.expect(jsonData.data).to.have.property('images');",
							"    pm.expect(jsonData.data).to.have.property('current_price');",
							"    pm.expect(jsonData.data).to.have.property('end_datetime');",
							"    pm.expect(jsonData.data).to.have.property('seller_info');",
							"    pm.expect(jsonData.data).to.have.property('bid_history');",
							"    pm.expect(jsonData.data).to.have.property('time_remaining');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/public/produtos/{{produtoId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"public",
						"produtos",
						"{{produtoId}}"
					]
				},
				"description": "Visualiza detalhes completos de um produto específico."
			}
		},
		{
			"name": "Histórico de Lances do Produto",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Bid history available\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data).to.be.an('array');",
							"});",
							"",
							"pm.test(\"Bids have public fields only\", function () {",
							"    const jsonData = pm.response.json();",
							"    if (jsonData.data.length > 0) {",
							"        const firstBid = jsonData.data[0];",
							"        pm.expect(firstBid).to.have.property('value');",
							"        pm.expect(firstBid).to.have.property('timestamp');",
							"        pm.expect(firstBid).to.have.property('bidder_name'); // Nome anonimizado",
							"        // Não deve expor dados sensíveis",
							"        pm.expect(firstBid).to.not.have.property('user_id');",
							"        pm.expect(firstBid).to.not.have.property('ip_address');",
							"    }",
							"});",
							"",
							"pm.test(\"Bids are ordered by timestamp desc\", function () {",
							"    const jsonData = pm.response.json();",
							"    if (jsonData.data.length > 1) {",
							"        for (let i = 0; i < jsonData.data.length - 1; i++) {",
							"            const currentBid = new Date(jsonData.data[i].timestamp);",
							"            const nextBid = new Date(jsonData.data[i + 1].timestamp);",
							"            pm.expect(currentBid).to.be.at.least(nextBid);",
							"        }",
							"    }",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/public/produtos/{{produtoId}}/lances",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"public",
						"produtos",
						"{{produtoId}}",
						"lances"
					]
				},
				"description": "Visualiza histórico público de lances de um produto."
			}
		},
		{
			"name": "Listar Produtos Terminando Hoje",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Products ending today\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.success).to.be.true;",
							"    ",
							"    const today = new Date();",
							"    const tomorrow = new Date(today);",
							"    tomorrow.setDate(tomorrow.getDate() + 1);",
							"    ",
							"    jsonData.data.forEach(produto => {",
							"        const endDate = new Date(produto.end_datetime);",
							"        pm.expect(endDate).to.be.below(tomorrow);",
							"        pm.expect(endDate).to.be.above(today);",
							"    });",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/public/produtos/ending-today",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"public",
						"produtos",
						"ending-today"
					]
				},
				"description": "Lista produtos que terminam hoje."
			}
		},
		{
			"name": "Listar Produtos Mais Disputados",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Most disputed products\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.success).to.be.true;",
							"    ",
							"    // Verificar se estão ordenados por número de lances (desc)",
							"    if (jsonData.data.length > 1) {",
							"        for (let i = 0; i < jsonData.data.length - 1; i++) {",
							"            const currentBids = jsonData.data[i].total_bids;",
							"            const nextBids = jsonData.data[i + 1].total_bids;",
							"            pm.expect(currentBids).to.be.at.least(nextBids);",
							"        }",
							"    }",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/public/produtos/most-disputed?limit=10",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"public",
						"produtos",
						"most-disputed"
					],
					"query": [
						{
							"key": "limit",
							"value": "10"
						}
					]
				},
				"description": "Lista os produtos mais disputados (com mais lances)."
			}
		},
		{
			"name": "Listar Categorias Disponíveis",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Categories available\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data).to.be.an('array');",
							"});",
							"",
							"pm.test(\"Categories have count\", function () {",
							"    const jsonData = pm.response.json();",
							"    if (jsonData.data.length > 0) {",
							"        const firstCategory = jsonData.data[0];",
							"        pm.expect(firstCategory).to.have.property('categoria');",
							"        pm.expect(firstCategory).to.have.property('total_produtos');",
							"        pm.expect(firstCategory.total_produtos).to.be.a('number');",
							"    }",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/public/categorias",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"public",
						"categorias"
					]
				},
				"description": "Lista todas as categorias disponíveis com contagem de produtos."
			}
		},
		{
			"name": "Estatísticas Públicas",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Public statistics available\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data).to.have.property('total_lotes_ativos');",
							"    pm.expect(jsonData.data).to.have.property('total_produtos_ativos');",
							"    pm.expect(jsonData.data).to.have.property('total_lances_hoje');",
							"    pm.expect(jsonData.data).to.have.property('valor_total_em_leilao');",
							"    pm.expect(jsonData.data).to.have.property('categorias_populares');",
							"    pm.expect(jsonData.data).to.have.property('produtos_terminando_24h');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/public/statistics",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"public",
						"statistics"
					]
				},
				"description": "Obtém estatísticas públicas do sistema de leilão."
			}
		},
		{
			"name": "Health Check Público",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"System is healthy\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data).to.have.property('status');",
							"    pm.expect(jsonData.data.status).to.equal('UP');",
							"    pm.expect(jsonData.data).to.have.property('timestamp');",
							"});",
							"",
							"pm.test(\"Response time is acceptable\", function () {",
							"    pm.expect(pm.response.responseTime).to.be.below(2000);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/public/health",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"public",
						"health"
					]
				},
				"description": "Verifica se a API pública está funcionando."
			}
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script global para endpoints públicos",
					"console.log('Acessando endpoint público:', pm.request.url.toString());"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script global para verificar resposta pública",
					"console.log('Resposta pública recebida com status:', pm.response.code);",
					"",
					"// Verificar se não há dados sensíveis expostos",
					"if (pm.response.code === 200) {",
					"    const jsonData = pm.response.json();",
					"    if (jsonData.data) {",
					"        const dataStr = JSON.stringify(jsonData.data);",
					"        const sensitiveFields = ['password', 'senha_hash', 'ip_address', 'user_agent', 'authorization_code'];",
					"        ",
					"        sensitiveFields.forEach(field => {",
					"            if (dataStr.includes(field)) {",
					"                console.warn('ATENÇÃO: Campo sensível detectado na resposta pública:', field);",
					"            }",
					"        });",
					"    }",
					"}"
				]
			}
		}
	]
}