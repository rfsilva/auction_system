{
	"info": {
		"_postman_id": "historia02-catalogo-lotes",
		"name": "História 02 - Catálogo de Lotes",
		"description": "Collection para testar os endpoints da História 02: Transformação do Catálogo em Catálogo de Lotes\n\n## Funcionalidades Testadas:\n- Catálogo público de lotes com produtos válidos\n- Lotes em destaque (encerrando em 1 semana)\n- Filtros por categoria e busca textual\n- Paginação configurável (10, 20, 50)\n- Ordenação por proximidade, recentes, alfabética\n\n## Massa de Dados:\n- Lotes ativos com produtos válidos\n- Diferentes categorias (Eletrônicos, Livros, Arte)\n- Produtos com status ACTIVE e PUBLISHED\n- Datas de encerramento variadas",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Auth",
			"item": [
				{
					"name": "Login Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    if (response.success && response.data.token) {",
									"        pm.environment.set('authToken', response.data.token);",
									"        pm.environment.set('refreshToken', response.data.refreshToken);",
									"        console.log('Token salvo:', response.data.token.substring(0, 20) + '...');",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"admin@leilao.com\",\n    \"password\": \"admin123\"\n}"
						},
						"url": {
							"raw": "{{apiUrl}}/auth/login",
							"host": [
								"{{apiUrl}}"
							],
							"path": [
								"auth",
								"login"
							]
						},
						"description": "Login como administrador para obter token de autenticação"
					},
					"response": []
				},
				{
					"name": "Login Vendedor",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    if (response.success && response.data.token) {",
									"        pm.environment.set('authToken', response.data.token);",
									"        pm.environment.set('refreshToken', response.data.refreshToken);",
									"        console.log('Token vendedor salvo:', response.data.token.substring(0, 20) + '...');",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"ana.santos@email.com\",\n    \"password\": \"senha123\"\n}"
						},
						"url": {
							"raw": "{{apiUrl}}/auth/login",
							"host": [
								"{{apiUrl}}"
							],
							"path": [
								"auth",
								"login"
							]
						},
						"description": "Login como vendedor (Ana Santos)"
					},
					"response": []
				}
			],
			"description": "Endpoints de autenticação para obter tokens"
		},
		{
			"name": "Catálogo Público de Lotes",
			"item": [
				{
					"name": "Listar Lotes - Catálogo Público",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Resposta tem estrutura correta', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"    pm.expect(response).to.have.property('data');",
									"    pm.expect(response.data).to.have.property('content');",
									"    pm.expect(response.data).to.have.property('totalElements');",
									"    pm.expect(response.data).to.have.property('totalPages');",
									"});",
									"",
									"pm.test('Lotes têm produtos válidos', function () {",
									"    const response = pm.response.json();",
									"    if (response.data.content.length > 0) {",
									"        const lote = response.data.content[0];",
									"        pm.expect(lote).to.have.property('totalProdutos');",
									"        pm.expect(lote.totalProdutos).to.be.above(0);",
									"        pm.expect(lote).to.have.property('isActive', true);",
									"    }",
									"});",
									"",
									"console.log('Total de lotes encontrados:', pm.response.json().data.totalElements);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{apiUrl}}/lotes/catalogo-publico?page={{page}}&size={{size}}&ordenacao={{ordenacao}}",
							"host": [
								"{{apiUrl}}"
							],
							"path": [
								"lotes",
								"catalogo-publico"
							],
							"query": [
								{
									"key": "page",
									"value": "{{page}}"
								},
								{
									"key": "size",
									"value": "{{size}}"
								},
								{
									"key": "ordenacao",
									"value": "{{ordenacao}}"
								}
							]
						},
						"description": "Lista lotes ativos com produtos válidos no catálogo público\n\n**Regras de Negócio:**\n- Apenas lotes com status ACTIVE\n- Apenas lotes com produtos válidos (ACTIVE/PUBLISHED)\n- Paginação configurável (10, 20, 50)\n- Ordenação por proximidade de encerramento (padrão)"
					},
					"response": []
				},
				{
					"name": "Listar Lotes - Com Filtro de Categoria",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Filtro de categoria aplicado', function () {",
									"    const response = pm.response.json();",
									"    if (response.data.content.length > 0) {",
									"        const lote = response.data.content[0];",
									"        pm.expect(lote).to.have.property('categoria', pm.environment.get('categoria'));",
									"    }",
									"});",
									"",
									"console.log('Lotes filtrados por categoria:', pm.environment.get('categoria'));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{apiUrl}}/lotes/catalogo-publico?categoria={{categoria}}&page=0&size=20",
							"host": [
								"{{apiUrl}}"
							],
							"path": [
								"lotes",
								"catalogo-publico"
							],
							"query": [
								{
									"key": "categoria",
									"value": "{{categoria}}"
								},
								{
									"key": "page",
									"value": "0"
								},
								{
									"key": "size",
									"value": "20"
								}
							]
						},
						"description": "Lista lotes filtrados por categoria específica"
					},
					"response": []
				},
				{
					"name": "Listar Lotes - Com Busca Textual",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Busca textual aplicada', function () {",
									"    const response = pm.response.json();",
									"    if (response.data.content.length > 0) {",
									"        const lote = response.data.content[0];",
									"        const termo = pm.environment.get('termo').toLowerCase();",
									"        const tituloLote = lote.title.toLowerCase();",
									"        const descricaoLote = lote.description.toLowerCase();",
									"        ",
									"        pm.expect(tituloLote.includes(termo) || descricaoLote.includes(termo)).to.be.true;",
									"    }",
									"});",
									"",
									"console.log('Busca por termo:', pm.environment.get('termo'));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{apiUrl}}/lotes/catalogo-publico?termo={{termo}}&page=0&size=10",
							"host": [
								"{{apiUrl}}"
							],
							"path": [
								"lotes",
								"catalogo-publico"
							],
							"query": [
								{
									"key": "termo",
									"value": "{{termo}}"
								},
								{
									"key": "page",
									"value": "0"
								},
								{
									"key": "size",
									"value": "10"
								}
							]
						},
						"description": "Lista lotes com busca textual no título e descrição"
					},
					"response": []
				},
				{
					"name": "Listar Lotes - Ordenação Recentes",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Ordenação por recentes', function () {",
									"    const response = pm.response.json();",
									"    if (response.data.content.length > 1) {",
									"        const primeiro = new Date(response.data.content[0].createdAt);",
									"        const segundo = new Date(response.data.content[1].createdAt);",
									"        pm.expect(primeiro.getTime()).to.be.at.least(segundo.getTime());",
									"    }",
									"});",
									"",
									"console.log('Ordenação aplicada: recentes');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{apiUrl}}/lotes/catalogo-publico?ordenacao=recentes&page=0&size=10",
							"host": [
								"{{apiUrl}}"
							],
							"path": [
								"lotes",
								"catalogo-publico"
							],
							"query": [
								{
									"key": "ordenacao",
									"value": "recentes"
								},
								{
									"key": "page",
									"value": "0"
								},
								{
									"key": "size",
									"value": "10"
								}
							]
						},
						"description": "Lista lotes ordenados por mais recentes (createdAt DESC)"
					},
					"response": []
				},
				{
					"name": "Listar Lotes - Paginação 50 por página",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Paginação configurada corretamente', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response.data).to.have.property('size', 50);",
									"    pm.expect(response.data).to.have.property('number', 0);",
									"});",
									"",
									"console.log('Tamanho da página:', pm.response.json().data.size);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{apiUrl}}/lotes/catalogo-publico?page=0&size=50",
							"host": [
								"{{apiUrl}}"
							],
							"path": [
								"lotes",
								"catalogo-publico"
							],
							"query": [
								{
									"key": "page",
									"value": "0"
								},
								{
									"key": "size",
									"value": "50"
								}
							]
						},
						"description": "Testa paginação com 50 lotes por página"
					},
					"response": []
				}
			],
			"description": "Endpoints do catálogo público de lotes com diferentes filtros e configurações"
		},
		{
			"name": "Lotes em Destaque",
			"item": [
				{
					"name": "Listar Lotes em Destaque",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Resposta tem estrutura correta', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"    pm.expect(response).to.have.property('data');",
									"    pm.expect(response.data).to.be.an('array');",
									"});",
									"",
									"pm.test('Lotes em destaque têm tempo restante <= 1 semana', function () {",
									"    const response = pm.response.json();",
									"    const umaSemanaEmSegundos = 7 * 24 * 60 * 60; // 604800 segundos",
									"    ",
									"    response.data.forEach(lote => {",
									"        pm.expect(lote).to.have.property('timeRemaining');",
									"        pm.expect(lote.timeRemaining).to.be.at.most(umaSemanaEmSegundos);",
									"        pm.expect(lote.timeRemaining).to.be.above(0);",
									"    });",
									"});",
									"",
									"console.log('Lotes em destaque encontrados:', pm.response.json().data.length);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{apiUrl}}/lotes/destaque",
							"host": [
								"{{apiUrl}}"
							],
							"path": [
								"lotes",
								"destaque"
							]
						},
						"description": "Lista lotes que encerram em 1 semana (7 dias)\n\n**Regras de Negócio:**\n- Apenas lotes ativos\n- Data de encerramento entre agora e 1 semana\n- Apenas lotes com produtos válidos\n- Ordenados por proximidade de encerramento"
					},
					"response": []
				}
			],
			"description": "Endpoints para lotes em destaque (encerrando em 1 semana)"
		},
		{
			"name": "Detalhes do Lote",
			"item": [
				{
					"name": "Buscar Lote por ID",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Lote encontrado', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"    pm.expect(response.data).to.have.property('id', pm.environment.get('loteId'));",
									"    pm.expect(response.data).to.have.property('title');",
									"    pm.expect(response.data).to.have.property('description');",
									"    pm.expect(response.data).to.have.property('totalProdutos');",
									"});",
									"",
									"console.log('Lote encontrado:', pm.response.json().data.title);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{apiUrl}}/lotes/{{loteId}}",
							"host": [
								"{{apiUrl}}"
							],
							"path": [
								"lotes",
								"{{loteId}}"
							]
						},
						"description": "Busca detalhes de um lote específico por ID"
					},
					"response": []
				},
				{
					"name": "Buscar Lote Inexistente",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 404', function () {",
									"    pm.response.to.have.status(404);",
									"});",
									"",
									"pm.test('Mensagem de erro apropriada', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', false);",
									"    pm.expect(response).to.have.property('message');",
									"});",
									"",
									"console.log('Erro esperado para lote inexistente');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{apiUrl}}/lotes/00000000-0000-0000-0000-000000000000",
							"host": [
								"{{apiUrl}}"
							],
							"path": [
								"lotes",
								"00000000-0000-0000-0000-000000000000"
							]
						},
						"description": "Testa comportamento ao buscar lote que não existe"
					},
					"response": []
				}
			],
			"description": "Endpoints para buscar detalhes de lotes específicos"
		},
		{
			"name": "Testes de Validação",
			"item": [
				{
					"name": "Teste Paginação Inválida",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 400 ou tratamento adequado', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([400, 200]);",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    pm.test('Paginação corrigida automaticamente', function () {",
									"        const response = pm.response.json();",
									"        pm.expect(response.data.number).to.be.at.least(0);",
									"    });",
									"}",
									"",
									"console.log('Teste de paginação inválida:', pm.response.code);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{apiUrl}}/lotes/catalogo-publico?page=-1&size=0",
							"host": [
								"{{apiUrl}}"
							],
							"path": [
								"lotes",
								"catalogo-publico"
							],
							"query": [
								{
									"key": "page",
									"value": "-1"
								},
								{
									"key": "size",
									"value": "0"
								}
							]
						},
						"description": "Testa comportamento com parâmetros de paginação inválidos"
					},
					"response": []
				},
				{
					"name": "Teste Ordenação Inválida",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200 - ordenação padrão aplicada', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Ordenação padrão aplicada', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"});",
									"",
									"console.log('Ordenação inválida tratada com padrão');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{apiUrl}}/lotes/catalogo-publico?ordenacao=invalida",
							"host": [
								"{{apiUrl}}"
							],
							"path": [
								"lotes",
								"catalogo-publico"
							],
							"query": [
								{
									"key": "ordenacao",
									"value": "invalida"
								}
							]
						},
						"description": "Testa comportamento com ordenação inválida (deve usar padrão)"
					},
					"response": []
				}
			],
			"description": "Testes de validação e casos extremos"
		},
		{
			"name": "Compatibilidade",
			"item": [
				{
					"name": "Endpoint Antigo - Catálogo Lotes",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200 - compatibilidade mantida', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Estrutura de resposta compatível', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"    pm.expect(response).to.have.property('data');",
									"});",
									"",
									"console.log('Endpoint antigo funcionando para compatibilidade');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{apiUrl}}/catalogo/lotes",
							"host": [
								"{{apiUrl}}"
							],
							"path": [
								"catalogo",
								"lotes"
							]
						},
						"description": "Testa endpoint antigo para garantir compatibilidade"
					},
					"response": []
				}
			],
			"description": "Testes de compatibilidade com endpoints antigos"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Log da requisição",
					"console.log('=== REQUISIÇÃO ===');",
					"console.log('Método:', pm.request.method);",
					"console.log('URL:', pm.request.url.toString());",
					"",
					"// Adicionar token de autorização se disponível",
					"const token = pm.environment.get('authToken');",
					"if (token && pm.request.headers) {",
					"    pm.request.headers.add({",
					"        key: 'Authorization',",
					"        value: 'Bearer ' + token",
					"    });",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Log da resposta",
					"console.log('=== RESPOSTA ===');",
					"console.log('Status:', pm.response.code);",
					"console.log('Tempo:', pm.response.responseTime + 'ms');",
					"",
					"// Teste global de performance",
					"pm.test('Performance adequada (< 2000ms)', function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(2000);",
					"});",
					"",
					"// Teste global de headers",
					"pm.test('Headers corretos', function () {",
					"    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
					"});"
				]
			}
		}
	],
	"variable": [
		{
			"key": "collectionVersion",
			"value": "1.0.0",
			"type": "string"
		},
		{
			"key": "collectionDescription",
			"value": "História 02 - Catálogo de Lotes",
			"type": "string"
		}
	]
}