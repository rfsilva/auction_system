{
	"info": {
		"_postman_id": "arremates-collection-id",
		"name": "09 - Arremates",
		"description": "Collection para testes do sistema de arremates do leilão eletrônico.\n\n**Funcionalidades cobertas:**\n- Listagem de arremates\n- Busca de arremate por ID\n- Arremates do comprador\n- Arremates do vendedor\n- Processamento de pagamento\n- Atualização de status de pagamento\n- Cálculo de taxas e comissões\n- Geração de documentos\n\n**Status de pagamento disponíveis:**\n- PENDING: Pagamento pendente\n- AUTHORIZED: Pagamento autorizado\n- CAPTURED: Pagamento capturado\n- FAILED: Pagamento falhou\n- REFUNDED: Pagamento reembolsado\n- CANCELLED: Pagamento cancelado\n\n**Pré-requisitos:**\n- Execute login de usuário antes dos testes\n- Sistema possui arremates de teste na massa de dados",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Listar Todos os Arremates",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Response has paginated data\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.data).to.have.property('content');",
							"    pm.expect(jsonData.data).to.have.property('totalElements');",
							"    pm.expect(jsonData.data).to.have.property('totalPages');",
							"    pm.expect(jsonData.data.content).to.be.an('array');",
							"});",
							"",
							"pm.test(\"Arremates have required fields\", function () {",
							"    const jsonData = pm.response.json();",
							"    const arremates = jsonData.data.content;",
							"    arremates.forEach(arremate => {",
							"        pm.expect(arremate).to.have.property('id');",
							"        pm.expect(arremate).to.have.property('produtoId');",
							"        pm.expect(arremate).to.have.property('winningBidId');",
							"        pm.expect(arremate).to.have.property('buyerId');",
							"        pm.expect(arremate).to.have.property('finalPrice');",
							"        pm.expect(arremate).to.have.property('feeAmount');",
							"        pm.expect(arremate).to.have.property('statusPayment');",
							"        pm.expect(arremate).to.have.property('createdAt');",
							"    });",
							"});",
							"",
							"// Salvar ID de um arremate para testes posteriores",
							"pm.test(\"Save arremate ID for later tests\", function () {",
							"    const jsonData = pm.response.json();",
							"    const arremates = jsonData.data.content;",
							"    if (arremates.length > 0) {",
							"        pm.environment.set('arremateId', arremates[0].id);",
							"    }",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/arremates?page=0&size=20",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"arremates"
					],
					"query": [
						{
							"key": "page",
							"value": "0"
						},
						{
							"key": "size",
							"value": "20"
						}
					]
				},
				"description": "Lista todos os arremates do sistema (requer permissão de admin)."
			}
		},
		{
			"name": "Meus Arremates como Comprador",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Response has paginated data\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.data).to.have.property('content');",
							"    pm.expect(jsonData.data.content).to.be.an('array');",
							"});",
							"",
							"pm.test(\"All arremates belong to authenticated buyer\", function () {",
							"    const jsonData = pm.response.json();",
							"    const arremates = jsonData.data.content;",
							"    // Note: We can't easily verify buyerId without knowing the current user ID",
							"    // This test ensures the structure is correct",
							"    arremates.forEach(arremate => {",
							"        pm.expect(arremate).to.have.property('buyerId');",
							"        pm.expect(arremate).to.have.property('produto');",
							"        pm.expect(arremate.produto).to.have.property('title');",
							"        pm.expect(arremate).to.have.property('vendedor');",
							"        pm.expect(arremate.vendedor).to.have.property('companyName');",
							"    });",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/arremates/meus-compras?page=0&size=20",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"arremates",
						"meus-compras"
					],
					"query": [
						{
							"key": "page",
							"value": "0"
						},
						{
							"key": "size",
							"value": "20"
						}
					]
				},
				"description": "Lista os arremates onde o usuário autenticado é o comprador."
			}
		},
		{
			"name": "Meus Arremates como Vendedor",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Response has paginated data\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.data).to.have.property('content');",
							"    pm.expect(jsonData.data.content).to.be.an('array');",
							"});",
							"",
							"pm.test(\"All arremates belong to authenticated seller\", function () {",
							"    const jsonData = pm.response.json();",
							"    const arremates = jsonData.data.content;",
							"    arremates.forEach(arremate => {",
							"        pm.expect(arremate).to.have.property('produto');",
							"        pm.expect(arremate.produto).to.have.property('sellerId');",
							"        pm.expect(arremate).to.have.property('comprador');",
							"        pm.expect(arremate.comprador).to.have.property('nome');",
							"    });",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/arremates/minhas-vendas?page=0&size=20",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"arremates",
						"minhas-vendas"
					],
					"query": [
						{
							"key": "page",
							"value": "0"
						},
						{
							"key": "size",
							"value": "20"
						}
					]
				},
				"description": "Lista os arremates onde o usuário autenticado é o vendedor."
			}
		},
		{
			"name": "Buscar Arremate por ID",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Arremate has detailed information\", function () {",
							"    const jsonData = pm.response.json();",
							"    const arremate = jsonData.data;",
							"    pm.expect(arremate).to.have.property('id');",
							"    pm.expect(arremate).to.have.property('finalPrice');",
							"    pm.expect(arremate).to.have.property('feeAmount');",
							"    pm.expect(arremate).to.have.property('statusPayment');",
							"    pm.expect(arremate).to.have.property('produto');",
							"    pm.expect(arremate).to.have.property('comprador');",
							"    pm.expect(arremate).to.have.property('vendedor');",
							"    pm.expect(arremate).to.have.property('winningBid');",
							"});",
							"",
							"pm.test(\"Financial calculations are present\", function () {",
							"    const jsonData = pm.response.json();",
							"    const arremate = jsonData.data;",
							"    pm.expect(arremate.finalPrice).to.be.a('number');",
							"    pm.expect(arremate.feeAmount).to.be.a('number');",
							"    pm.expect(arremate.finalPrice).to.be.above(0);",
							"    pm.expect(arremate.feeAmount).to.be.at.least(0);",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"// Verificar se temos um ID de arremate salvo",
							"const arremateId = pm.environment.get('arremateId');",
							"if (!arremateId) {",
							"    console.log('Nenhum ID de arremate encontrado. Execute \"Listar Todos os Arremates\" primeiro.');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/arremates/{{arremateId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"arremates",
						"{{arremateId}}"
					]
				},
				"description": "Busca um arremate específico por ID com informações detalhadas."
			}
		},
		{
			"name": "Filtrar Arremates por Status - Pendentes",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"All arremates have PENDING status\", function () {",
							"    const jsonData = pm.response.json();",
							"    const arremates = jsonData.data.content;",
							"    arremates.forEach(arremate => {",
							"        pm.expect(arremate.statusPayment).to.equal('PENDING');",
							"    });",
							"});",
							"",
							"pm.test(\"Pending arremates have payment due date\", function () {",
							"    const jsonData = pm.response.json();",
							"    const arremates = jsonData.data.content;",
							"    arremates.forEach(arremate => {",
							"        if (arremate.statusPayment === 'PENDING') {",
							"            pm.expect(arremate).to.have.property('paymentDueDate');",
							"        }",
							"    });",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/arremates?statusPayment=PENDING&page=0&size=20",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"arremates"
					],
					"query": [
						{
							"key": "statusPayment",
							"value": "PENDING"
						},
						{
							"key": "page",
							"value": "0"
						},
						{
							"key": "size",
							"value": "20"
						}
					]
				},
				"description": "Lista arremates com status de pagamento pendente."
			}
		},
		{
			"name": "Processar Pagamento - Autorizar",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Payment status updated to AUTHORIZED\", function () {",
							"    const jsonData = pm.response.json();",
							"    const arremate = jsonData.data;",
							"    pm.expect(arremate).to.have.property('statusPayment');",
							"    pm.expect(arremate.statusPayment).to.equal('AUTHORIZED');",
							"});",
							"",
							"pm.test(\"Payment processing information is present\", function () {",
							"    const jsonData = pm.response.json();",
							"    const arremate = jsonData.data;",
							"    pm.expect(arremate).to.have.property('paymentProcessedAt');",
							"    pm.expect(arremate).to.have.property('paymentReference');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "{{contentType}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"action\": \"AUTHORIZE\",\n    \"paymentMethod\": \"CREDIT_CARD\",\n    \"paymentReference\": \"CC_{{$randomUUID}}\",\n    \"amount\": null,\n    \"notes\": \"Pagamento autorizado via Postman para testes\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/arremates/{{arremateId}}/pagamento",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"arremates",
						"{{arremateId}}",
						"pagamento"
					]
				},
				"description": "Processa o pagamento de um arremate, autorizando a transação."
			}
		},
		{
			"name": "Capturar Pagamento",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Payment status updated to CAPTURED\", function () {",
							"    const jsonData = pm.response.json();",
							"    const arremate = jsonData.data;",
							"    pm.expect(arremate.statusPayment).to.equal('CAPTURED');",
							"});",
							"",
							"pm.test(\"Payment captured timestamp is present\", function () {",
							"    const jsonData = pm.response.json();",
							"    const arremate = jsonData.data;",
							"    pm.expect(arremate).to.have.property('paidAt');",
							"    pm.expect(arremate.paidAt).to.not.be.null;",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "{{contentType}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"action\": \"CAPTURE\",\n    \"paymentMethod\": \"CREDIT_CARD\",\n    \"paymentReference\": \"CC_CAPTURE_{{$randomUUID}}\",\n    \"amount\": null,\n    \"notes\": \"Pagamento capturado via Postman para testes\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/arremates/{{arremateId}}/pagamento",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"arremates",
						"{{arremateId}}",
						"pagamento"
					]
				},
				"description": "Captura o pagamento de um arremate previamente autorizado."
			}
		},
		{
			"name": "Calcular Taxas e Comissões",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Calculation has required fields\", function () {",
							"    const jsonData = pm.response.json();",
							"    const calculo = jsonData.data;",
							"    pm.expect(calculo).to.have.property('valorFinal');",
							"    pm.expect(calculo).to.have.property('taxaComissao');",
							"    pm.expect(calculo).to.have.property('valorComissao');",
							"    pm.expect(calculo).to.have.property('valorLiquido');",
							"    pm.expect(calculo).to.have.property('impostos');",
							"});",
							"",
							"pm.test(\"Financial values are consistent\", function () {",
							"    const jsonData = pm.response.json();",
							"    const calculo = jsonData.data;",
							"    pm.expect(calculo.valorFinal).to.be.a('number');",
							"    pm.expect(calculo.valorComissao).to.be.a('number');",
							"    pm.expect(calculo.valorLiquido).to.be.a('number');",
							"    pm.expect(calculo.valorFinal).to.be.above(0);",
							"    pm.expect(calculo.valorLiquido).to.be.below(calculo.valorFinal);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/arremates/{{arremateId}}/calculo-taxas",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"arremates",
						"{{arremateId}}",
						"calculo-taxas"
					]
				},
				"description": "Calcula as taxas e comissões de um arremate específico."
			}
		},
		{
			"name": "Gerar Documento - Nota Fiscal",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200 or 201\", function () {",
							"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Document generated with correct information\", function () {",
							"    const jsonData = pm.response.json();",
							"    const documento = jsonData.data;",
							"    pm.expect(documento).to.have.property('id');",
							"    pm.expect(documento).to.have.property('type');",
							"    pm.expect(documento.type).to.equal('INVOICE');",
							"    pm.expect(documento).to.have.property('filename');",
							"    pm.expect(documento).to.have.property('storageUrl');",
							"    pm.expect(documento).to.have.property('fileSize');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "{{contentType}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"documentType\": \"INVOICE\",\n    \"format\": \"PDF\",\n    \"includeDetails\": true,\n    \"includePaymentInfo\": true,\n    \"language\": \"pt-BR\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/arremates/{{arremateId}}/documentos",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"arremates",
						"{{arremateId}}",
						"documentos"
					]
				},
				"description": "Gera uma nota fiscal para o arremate."
			}
		},
		{
			"name": "Estatísticas de Arremates",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Statistics have required fields\", function () {",
							"    const jsonData = pm.response.json();",
							"    const stats = jsonData.data;",
							"    pm.expect(stats).to.have.property('totalArremates');",
							"    pm.expect(stats).to.have.property('valorTotalArremates');",
							"    pm.expect(stats).to.have.property('valorMedioArremate');",
							"    pm.expect(stats).to.have.property('porStatusPagamento');",
							"    pm.expect(stats).to.have.property('ultimoMes');",
							"    pm.expect(stats.totalArremates).to.be.a('number');",
							"    pm.expect(stats.valorTotalArremates).to.be.a('number');",
							"    pm.expect(stats.porStatusPagamento).to.be.an('object');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/arremates/estatisticas",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"arremates",
						"estatisticas"
					]
				},
				"description": "Obtém estatísticas gerais dos arremates do usuário."
			}
		},
		{
			"name": "Buscar Arremate Inexistente",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 404\", function () {",
							"    pm.response.to.have.status(404);",
							"});",
							"",
							"pm.test(\"Response has error message\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.false;",
							"    pm.expect(jsonData).to.have.property('message');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/arremates/999e8400-e29b-41d4-a716-446655440999",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"arremates",
						"999e8400-e29b-41d4-a716-446655440999"
					]
				},
				"description": "Testa busca por arremate que não existe no sistema."
			}
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{authToken}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script global executado antes de cada requisição",
					"console.log('Executando requisição para arremates:', pm.request.url.toString());"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script global executado após cada requisição",
					"console.log('Resposta recebida com status:', pm.response.code);"
				]
			}
		}
	]
}