{
	"info": {
		"_postman_id": "admin-documents-collection-id",
		"name": "15 - Administração - Documentos",
		"description": "Collection para administração de documentos do sistema de leilão.\n\n**Funcionalidades cobertas:**\n- Listar documentos por entidade\n- Upload de documentos\n- Download de documentos\n- Validar documentos\n- Gerar documentos automáticos\n- Excluir documentos\n- Estatísticas de documentos\n\n**Tipos de documentos:**\n- INVOICE: Faturas de vendas\n- RECEIPT: Comprovantes de pagamento\n- CONTRACT: Contratos de vendedores\n- IDENTITY: Documentos de identidade\n- PROOF_ADDRESS: Comprovantes de endereço\n- PRODUCT_CERTIFICATE: Certificados de produtos\n\n**Requer autenticação:** Admin",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Listar Todos os Documentos",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has documents list\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data).to.be.an('array');",
							"});",
							"",
							"pm.test(\"Documents have required fields\", function () {",
							"    const jsonData = pm.response.json();",
							"    if (jsonData.data.length > 0) {",
							"        const firstDoc = jsonData.data[0];",
							"        pm.expect(firstDoc).to.have.property('id');",
							"        pm.expect(firstDoc).to.have.property('entity_id');",
							"        pm.expect(firstDoc).to.have.property('entity_type');",
							"        pm.expect(firstDoc).to.have.property('type');",
							"        pm.expect(firstDoc).to.have.property('filename');",
							"        pm.expect(firstDoc).to.have.property('file_size');",
							"    }",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/admin/documents?page=0&size=50",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"admin",
						"documents"
					],
					"query": [
						{
							"key": "page",
							"value": "0"
						},
						{
							"key": "size",
							"value": "50"
						}
					]
				},
				"description": "Lista todos os documentos do sistema com paginação."
			}
		},
		{
			"name": "Listar Documentos por Tipo",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"All documents are INVOICE type\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.success).to.be.true;",
							"    jsonData.data.forEach(doc => {",
							"        pm.expect(doc.type).to.equal('INVOICE');",
							"    });",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/admin/documents?type=INVOICE",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"admin",
						"documents"
					],
					"query": [
						{
							"key": "type",
							"value": "INVOICE"
						}
					]
				},
				"description": "Lista documentos filtrados por tipo específico."
			}
		},
		{
			"name": "Listar Documentos por Entidade",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"All documents for USUARIO entity\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.success).to.be.true;",
							"    jsonData.data.forEach(doc => {",
							"        pm.expect(doc.entity_type).to.equal('USUARIO');",
							"    });",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/admin/documents?entity_type=USUARIO&entity_id={{vendedorId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"admin",
						"documents"
					],
					"query": [
						{
							"key": "entity_type",
							"value": "USUARIO"
						},
						{
							"key": "entity_id",
							"value": "{{vendedorId}}"
						}
					]
				},
				"description": "Lista documentos de uma entidade específica."
			}
		},
		{
			"name": "Visualizar Detalhes do Documento",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Document details complete\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data).to.have.property('id');",
							"    pm.expect(jsonData.data).to.have.property('filename');",
							"    pm.expect(jsonData.data).to.have.property('storage_url');",
							"    pm.expect(jsonData.data).to.have.property('file_hash');",
							"    pm.expect(jsonData.data).to.have.property('mime_type');",
							"    pm.expect(jsonData.data).to.have.property('created_at');",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"// ID de documento de teste",
							"pm.environment.set('testDocumentId', 'doc1e8400-e29b-41d4-a716-446655440001');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/admin/documents/{{testDocumentId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"admin",
						"documents",
						"{{testDocumentId}}"
					]
				},
				"description": "Visualiza detalhes completos de um documento específico."
			}
		},
		{
			"name": "Upload de Documento",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 201\", function () {",
							"    pm.response.to.have.status(201);",
							"});",
							"",
							"pm.test(\"Document uploaded successfully\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data).to.have.property('id');",
							"    pm.expect(jsonData.data).to.have.property('filename');",
							"    pm.expect(jsonData.data).to.have.property('storage_url');",
							"    ",
							"    // Salvar ID do documento",
							"    pm.environment.set('uploadedDocumentId', jsonData.data.id);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{
							"key": "file",
							"type": "file",
							"src": [],
							"description": "Arquivo a ser enviado"
						},
						{
							"key": "entity_type",
							"value": "USUARIO",
							"type": "text"
						},
						{
							"key": "entity_id",
							"value": "{{vendedorId}}",
							"type": "text"
						},
						{
							"key": "document_type",
							"value": "IDENTITY",
							"type": "text"
						},
						{
							"key": "description",
							"value": "RG do vendedor Carlos",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{baseUrl}}/api/admin/documents/upload",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"admin",
						"documents",
						"upload"
					]
				},
				"description": "Faz upload de um novo documento."
			}
		},
		{
			"name": "Gerar Documento Automático - Fatura",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 201\", function () {",
							"    pm.response.to.have.status(201);",
							"});",
							"",
							"pm.test(\"Invoice generated successfully\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data).to.have.property('id');",
							"    pm.expect(jsonData.data.type).to.equal('INVOICE');",
							"    pm.expect(jsonData.data).to.have.property('download_url');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "{{contentType}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"type\": \"INVOICE\",\n    \"entity_type\": \"ARREMATE\",\n    \"entity_id\": \"aa1e8400-e29b-41d4-a716-446655440001\",\n    \"template\": \"invoice_standard\",\n    \"data\": {\n        \"buyer_name\": \"Fernanda Rodrigues Lima\",\n        \"buyer_email\": \"fernanda.lima@email.com\",\n        \"seller_name\": \"ABC Importadora\",\n        \"product_title\": \"Smartphone Samsung Galaxy S23 Ultra\",\n        \"final_price\": 3250.00,\n        \"fee_amount\": 113.75,\n        \"payment_date\": \"2024-12-19\"\n    }\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/admin/documents/generate",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"admin",
						"documents",
						"generate"
					]
				},
				"description": "Gera automaticamente uma fatura de venda."
			}
		},
		{
			"name": "Gerar Documento Automático - Contrato",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 201\", function () {",
							"    pm.response.to.have.status(201);",
							"});",
							"",
							"pm.test(\"Contract generated successfully\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data.type).to.equal('CONTRACT');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "{{contentType}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"type\": \"CONTRACT\",\n    \"entity_type\": \"CONTRATO\",\n    \"entity_id\": \"{{contratoId}}\",\n    \"template\": \"contract_seller\",\n    \"data\": {\n        \"seller_name\": \"ABC Importadora\",\n        \"seller_cnpj\": \"12.345.678/0001-90\",\n        \"fee_rate\": 3.5,\n        \"valid_from\": \"2024-01-01\",\n        \"valid_to\": \"2024-12-31\",\n        \"category\": \"Eletrônicos\"\n    }\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/admin/documents/generate",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"admin",
						"documents",
						"generate"
					]
				},
				"description": "Gera automaticamente um contrato de vendedor."
			}
		},
		{
			"name": "Download de Documento",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"File downloaded successfully\", function () {",
							"    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/');",
							"    pm.expect(pm.response.headers.get('Content-Disposition')).to.include('attachment');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/admin/documents/{{testDocumentId}}/download",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"admin",
						"documents",
						"{{testDocumentId}}",
						"download"
					]
				},
				"description": "Faz download de um documento específico."
			}
		},
		{
			"name": "Validar Documento",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Document validated successfully\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data).to.have.property('valid');",
							"    pm.expect(jsonData.data).to.have.property('hash_match');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "{{contentType}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"validation_type\": \"INTEGRITY\",\n    \"check_hash\": true,\n    \"check_signature\": false\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/admin/documents/{{testDocumentId}}/validate",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"admin",
						"documents",
						"{{testDocumentId}}",
						"validate"
					]
				},
				"description": "Valida a integridade de um documento."
			}
		},
		{
			"name": "Atualizar Metadados do Documento",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Document metadata updated\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "{{contentType}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"filename\": \"RG_Carlos_Vendedor_Verificado.pdf\",\n    \"description\": \"Documento de identidade verificado e aprovado\",\n    \"tags\": [\"verificado\", \"aprovado\", \"identidade\"],\n    \"expires_at\": \"2025-12-31T23:59:59Z\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/admin/documents/{{uploadedDocumentId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"admin",
						"documents",
						"{{uploadedDocumentId}}"
					]
				},
				"description": "Atualiza metadados de um documento existente."
			}
		},
		{
			"name": "Listar Documentos Expirados",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Expired documents found\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.success).to.be.true;",
							"    ",
							"    const now = new Date();",
							"    jsonData.data.forEach(doc => {",
							"        if (doc.expires_at) {",
							"            const expiryDate = new Date(doc.expires_at);",
							"            pm.expect(expiryDate).to.be.below(now);",
							"        }",
							"    });",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/admin/documents/expired",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"admin",
						"documents",
						"expired"
					]
				},
				"description": "Lista documentos que já expiraram."
			}
		},
		{
			"name": "Excluir Documento",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Document deleted successfully\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "{{contentType}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"motivo\": \"Documento duplicado, mantendo apenas a versão mais recente\",\n    \"delete_from_storage\": true\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/admin/documents/{{uploadedDocumentId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"admin",
						"documents",
						"{{uploadedDocumentId}}"
					]
				},
				"description": "Exclui um documento do sistema."
			}
		},
		{
			"name": "Estatísticas de Documentos",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Document statistics complete\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.data).to.have.property('total_documentos');",
							"    pm.expect(jsonData.data).to.have.property('por_tipo');",
							"    pm.expect(jsonData.data).to.have.property('por_entidade');",
							"    pm.expect(jsonData.data).to.have.property('tamanho_total');",
							"    pm.expect(jsonData.data).to.have.property('documentos_expirados');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/admin/documents/statistics",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"admin",
						"documents",
						"statistics"
					]
				},
				"description": "Obtém estatísticas gerais sobre os documentos."
			}
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{authToken}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Verificar se está logado como admin",
					"const authToken = pm.environment.get('authToken');",
					"if (!authToken) {",
					"    console.log('Token de autenticação não encontrado. Execute o login de admin primeiro.');",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script global para verificar autorização",
					"if (pm.response.code === 403) {",
					"    console.log('Acesso negado. Certifique-se de estar logado como administrador.');",
					"}"
				]
			}
		}
	]
}