{
	"info": {
		"_postman_id": "notificacoes-collection-id",
		"name": "08 - Notificações",
		"description": "Collection para testes do sistema de notificações do leilão eletrônico.\n\n**Funcionalidades cobertas:**\n- Listagem de notificações do usuário\n- Marcar notificação como lida\n- Marcar todas como lidas\n- Buscar notificações por tipo\n- Estatísticas de notificações\n- Configurações de notificação\n\n**Tipos de notificação disponíveis:**\n- BID_OUTBID: Lance superado\n- AUCTION_ENDING: Leilão terminando\n- NEW_PRODUCT_CATEGORY: Novo produto na categoria favorita\n- ACCOUNT_VERIFICATION: Verificação de conta\n- SELLER_VERIFICATION: Verificação de vendedor\n- PAYMENT_DUE: Pagamento pendente\n\n**Pré-requisitos:**\n- Execute login de usuário antes dos testes\n- Sistema possui notificações de teste na massa de dados",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Listar Minhas Notificações",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Response has paginated data\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.data).to.have.property('content');",
							"    pm.expect(jsonData.data).to.have.property('totalElements');",
							"    pm.expect(jsonData.data).to.have.property('totalPages');",
							"    pm.expect(jsonData.data.content).to.be.an('array');",
							"});",
							"",
							"pm.test(\"Notificações have required fields\", function () {",
							"    const jsonData = pm.response.json();",
							"    const notificacoes = jsonData.data.content;",
							"    notificacoes.forEach(notificacao => {",
							"        pm.expect(notificacao).to.have.property('id');",
							"        pm.expect(notificacao).to.have.property('type');",
							"        pm.expect(notificacao).to.have.property('title');",
							"        pm.expect(notificacao).to.have.property('message');",
							"        pm.expect(notificacao).to.have.property('status');",
							"        pm.expect(notificacao).to.have.property('createdAt');",
							"    });",
							"});",
							"",
							"pm.test(\"Notificações are ordered by creation date desc\", function () {",
							"    const jsonData = pm.response.json();",
							"    const notificacoes = jsonData.data.content;",
							"    if (notificacoes.length > 1) {",
							"        for (let i = 0; i < notificacoes.length - 1; i++) {",
							"            const current = new Date(notificacoes[i].createdAt);",
							"            const next = new Date(notificacoes[i + 1].createdAt);",
							"            pm.expect(current.getTime()).to.be.at.least(next.getTime());",
							"        }",
							"    }",
							"});",
							"",
							"// Salvar ID de uma notificação para testes posteriores",
							"pm.test(\"Save notification ID for later tests\", function () {",
							"    const jsonData = pm.response.json();",
							"    const notificacoes = jsonData.data.content;",
							"    if (notificacoes.length > 0) {",
							"        pm.environment.set('notificacaoId', notificacoes[0].id);",
							"    }",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/notificacoes?page=0&size=20",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"notificacoes"
					],
					"query": [
						{
							"key": "page",
							"value": "0"
						},
						{
							"key": "size",
							"value": "20"
						}
					]
				},
				"description": "Lista todas as notificações do usuário autenticado."
			}
		},
		{
			"name": "Listar Notificações Não Lidas",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"All notifications are unread\", function () {",
							"    const jsonData = pm.response.json();",
							"    const notificacoes = jsonData.data.content;",
							"    notificacoes.forEach(notificacao => {",
							"        pm.expect(notificacao.status).to.not.equal('READ');",
							"        pm.expect(notificacao).to.not.have.property('readAt');",
							"    });",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/notificacoes?status=PENDING,SENT&page=0&size=20",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"notificacoes"
					],
					"query": [
						{
							"key": "status",
							"value": "PENDING,SENT"
						},
						{
							"key": "page",
							"value": "0"
						},
						{
							"key": "size",
							"value": "20"
						}
					]
				},
				"description": "Lista apenas as notificações não lidas do usuário."
			}
		},
		{
			"name": "Buscar Notificações por Tipo - Lance Superado",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"All notifications are of BID_OUTBID type\", function () {",
							"    const jsonData = pm.response.json();",
							"    const notificacoes = jsonData.data.content;",
							"    notificacoes.forEach(notificacao => {",
							"        pm.expect(notificacao.type).to.equal('BID_OUTBID');",
							"    });",
							"});",
							"",
							"pm.test(\"Notifications have bid-related data\", function () {",
							"    const jsonData = pm.response.json();",
							"    const notificacoes = jsonData.data.content;",
							"    notificacoes.forEach(notificacao => {",
							"        if (notificacao.data) {",
							"            const data = JSON.parse(notificacao.data);",
							"            pm.expect(data).to.have.property('produto_id');",
							"            pm.expect(data).to.have.property('lance_anterior');",
							"            pm.expect(data).to.have.property('lance_atual');",
							"        }",
							"    });",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/notificacoes?type=BID_OUTBID&page=0&size=10",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"notificacoes"
					],
					"query": [
						{
							"key": "type",
							"value": "BID_OUTBID"
						},
						{
							"key": "page",
							"value": "0"
						},
						{
							"key": "size",
							"value": "10"
						}
					]
				},
				"description": "Busca notificações específicas do tipo 'Lance Superado'."
			}
		},
		{
			"name": "Marcar Notificação como Lida",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Notification is marked as read\", function () {",
							"    const jsonData = pm.response.json();",
							"    const notificacao = jsonData.data;",
							"    pm.expect(notificacao).to.have.property('status');",
							"    pm.expect(notificacao.status).to.equal('READ');",
							"    pm.expect(notificacao).to.have.property('readAt');",
							"    pm.expect(notificacao.readAt).to.not.be.null;",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"// Verificar se temos um ID de notificação salvo",
							"const notificacaoId = pm.environment.get('notificacaoId');",
							"if (!notificacaoId) {",
							"    console.log('Nenhum ID de notificação encontrado. Execute \"Listar Minhas Notificações\" primeiro.');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/notificacoes/{{notificacaoId}}/marcar-lida",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"notificacoes",
						"{{notificacaoId}}",
						"marcar-lida"
					]
				},
				"description": "Marca uma notificação específica como lida."
			}
		},
		{
			"name": "Marcar Todas como Lidas",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Response indicates number of updated notifications\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.data).to.have.property('updatedCount');",
							"    pm.expect(jsonData.data.updatedCount).to.be.a('number');",
							"    pm.expect(jsonData.data.updatedCount).to.be.at.least(0);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/notificacoes/marcar-todas-lidas",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"notificacoes",
						"marcar-todas-lidas"
					]
				},
				"description": "Marca todas as notificações não lidas do usuário como lidas."
			}
		},
		{
			"name": "Contar Notificações Não Lidas",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Response has unread count\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.data).to.have.property('unreadCount');",
							"    pm.expect(jsonData.data.unreadCount).to.be.a('number');",
							"    pm.expect(jsonData.data.unreadCount).to.be.at.least(0);",
							"});",
							"",
							"pm.test(\"After marking all as read, count should be 0\", function () {",
							"    const jsonData = pm.response.json();",
							"    // Este teste assume que executamos \"Marcar Todas como Lidas\" antes",
							"    pm.expect(jsonData.data.unreadCount).to.equal(0);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/notificacoes/count/unread",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"notificacoes",
						"count",
						"unread"
					]
				},
				"description": "Conta o número de notificações não lidas do usuário."
			}
		},
		{
			"name": "Criar Notificação de Teste",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200 or 201\", function () {",
							"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Notification created with correct data\", function () {",
							"    const jsonData = pm.response.json();",
							"    const notificacao = jsonData.data;",
							"    pm.expect(notificacao).to.have.property('id');",
							"    pm.expect(notificacao).to.have.property('type');",
							"    pm.expect(notificacao.type).to.equal('SYSTEM_TEST');",
							"    pm.expect(notificacao).to.have.property('title');",
							"    pm.expect(notificacao.title).to.include('Teste');",
							"    pm.expect(notificacao).to.have.property('status');",
							"    pm.expect(notificacao.status).to.equal('PENDING');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "{{contentType}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"type\": \"SYSTEM_TEST\",\n    \"title\": \"Notificação de Teste via Postman\",\n    \"message\": \"Esta é uma notificação de teste criada através da collection do Postman para verificar o funcionamento do sistema.\",\n    \"data\": {\n        \"source\": \"postman\",\n        \"timestamp\": \"{{$timestamp}}\",\n        \"testId\": \"{{$randomUUID}}\"\n    }\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/notificacoes",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"notificacoes"
					]
				},
				"description": "Cria uma notificação de teste para verificar o funcionamento do sistema."
			}
		},
		{
			"name": "Estatísticas de Notificações",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Statistics have required fields\", function () {",
							"    const jsonData = pm.response.json();",
							"    const stats = jsonData.data;",
							"    pm.expect(stats).to.have.property('totalNotificacoes');",
							"    pm.expect(stats).to.have.property('naoLidas');",
							"    pm.expect(stats).to.have.property('lidas');",
							"    pm.expect(stats).to.have.property('porTipo');",
							"    pm.expect(stats).to.have.property('ultimaSemana');",
							"    pm.expect(stats.totalNotificacoes).to.be.a('number');",
							"    pm.expect(stats.naoLidas).to.be.a('number');",
							"    pm.expect(stats.lidas).to.be.a('number');",
							"    pm.expect(stats.porTipo).to.be.an('object');",
							"});",
							"",
							"pm.test(\"Total equals read + unread\", function () {",
							"    const jsonData = pm.response.json();",
							"    const stats = jsonData.data;",
							"    pm.expect(stats.totalNotificacoes).to.equal(stats.lidas + stats.naoLidas);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/notificacoes/estatisticas",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"notificacoes",
						"estatisticas"
					]
				},
				"description": "Obtém estatísticas das notificações do usuário."
			}
		},
		{
			"name": "Configurações de Notificação",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Configuration has notification preferences\", function () {",
							"    const jsonData = pm.response.json();",
							"    const config = jsonData.data;",
							"    pm.expect(config).to.have.property('emailNotifications');",
							"    pm.expect(config).to.have.property('pushNotifications');",
							"    pm.expect(config).to.have.property('bidOutbidNotifications');",
							"    pm.expect(config).to.have.property('auctionEndingNotifications');",
							"    pm.expect(config).to.have.property('newProductNotifications');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/notificacoes/configuracoes",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"notificacoes",
						"configuracoes"
					]
				},
				"description": "Obtém as configurações de notificação do usuário."
			}
		},
		{
			"name": "Atualizar Configurações de Notificação",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success field\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('success');",
							"    pm.expect(jsonData.success).to.be.true;",
							"});",
							"",
							"pm.test(\"Configuration updated correctly\", function () {",
							"    const jsonData = pm.response.json();",
							"    const config = jsonData.data;",
							"    pm.expect(config.emailNotifications).to.be.false;",
							"    pm.expect(config.bidOutbidNotifications).to.be.true;",
							"    pm.expect(config.auctionEndingNotifications).to.be.true;",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "{{contentType}}",
						"type": "text"
					},
					{
						"key": "Accept",
						"value": "{{acceptType}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"emailNotifications\": false,\n    \"pushNotifications\": true,\n    \"bidOutbidNotifications\": true,\n    \"auctionEndingNotifications\": true,\n    \"newProductNotifications\": false,\n    \"paymentNotifications\": true,\n    \"systemNotifications\": true\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/notificacoes/configuracoes",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"notificacoes",
						"configuracoes"
					]
				},
				"description": "Atualiza as configurações de notificação do usuário."
			}
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{authToken}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script global executado antes de cada requisição",
					"console.log('Executando requisição para notificações:', pm.request.url.toString());"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script global executado após cada requisição",
					"console.log('Resposta recebida com status:', pm.response.code);"
				]
			}
		}
	]
}