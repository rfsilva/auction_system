<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <div class="card shadow">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
          <div>
            <h4 class="mb-0">
              <i class="fas fa-file-contract me-2"></i>
              Meus Contratos Ativos
            </h4>
            <small class="opacity-75">Visualize seus contratos ativos e suas condições</small>
          </div>
          <button 
            class="btn btn-light btn-sm" 
            (click)="recarregar()" 
            [disabled]="loading"
            title="Recarregar">
            <i class="fas fa-sync-alt" [class.fa-spin]="loading"></i>
          </button>
        </div>
        
        <div class="card-body">
          <!-- Loading -->
          <div *ngIf="loading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Carregando...</span>
            </div>
            <p class="mt-3 text-muted">Carregando seus contratos ativos...</p>
          </div>

          <!-- Error -->
          <div *ngIf="error && !loading" class="alert alert-danger" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            {{ error }}
            <button class="btn btn-sm btn-outline-danger ms-2" (click)="recarregar()">
              <i class="fas fa-redo me-1"></i>
              Tentar Novamente
            </button>
          </div>

          <!-- Sem contratos -->
          <div *ngIf="!loading && !error && contratosAtivos.length === 0" class="text-center py-5">
            <i class="fas fa-file-contract fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">Nenhum contrato ativo encontrado</h5>
            <p class="text-muted">
              Você não possui contratos ativos no momento. 
              Entre em contato com a administração para ativar um contrato.
            </p>
          </div>

          <!-- Lista de contratos -->
          <div *ngIf="!loading && !error && contratosAtivos.length > 0">
            
            <!-- Resumo -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="alert alert-info">
                  <i class="fas fa-info-circle me-2"></i>
                  <strong>{{ contratosAtivos.length }}</strong> 
                  {{ contratosAtivos.length === 1 ? 'contrato ativo encontrado' : 'contratos ativos encontrados' }}
                </div>
              </div>
            </div>

            <!-- Cards dos contratos -->
            <div class="row">
              <div *ngFor="let contrato of contratosAtivos; trackBy: trackByContratoId" class="col-lg-6 mb-4">
                <div class="card h-100 border-start border-4" 
                     [class.border-success]="contrato.status === ContractStatus.ACTIVE"
                     [class.border-warning]="isProximoVencimento(contrato)">
                  
                  <!-- Header do card -->
                  <div class="card-header bg-light">
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <h6 class="mb-1">
                          <i class="fas fa-tag me-2"></i>
                          {{ contrato.categoria || 'Contrato Geral' }}
                        </h6>
                        <small class="text-muted">ID: {{ contrato.id.substring(0, 8) }}...</small>
                      </div>
                      <div class="text-end">
                        <span class="badge" [ngClass]="getStatusClass(contrato.status)">
                          {{ getStatusText(contrato.status) }}
                        </span>
                        <div *ngIf="isProximoVencimento(contrato)" class="mt-1">
                          <small class="text-warning">
                            <i class="fas fa-exclamation-triangle me-1"></i>
                            Próximo ao vencimento
                          </small>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Corpo do card -->
                  <div class="card-body">
                    
                    <!-- Informações principais -->
                    <div class="row mb-3">
                      <div class="col-6">
                        <div class="text-center p-3 bg-light rounded">
                          <div class="h4 mb-1 text-primary">{{ formatarTaxa(contrato.feeRate) }}</div>
                          <small class="text-muted">Taxa de Comissão</small>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="text-center p-3 bg-light rounded">
                          <div class="h6 mb-1">
                            <span *ngIf="contrato.validTo; else semVencimento" class="text-success">
                              {{ calcularDiasRestantes(contrato.validTo) }} dias
                            </span>
                            <ng-template #semVencimento>
                              <span class="text-info">Sem vencimento</span>
                            </ng-template>
                          </div>
                          <small class="text-muted">Tempo Restante</small>
                        </div>
                      </div>
                    </div>

                    <!-- Datas -->
                    <div class="mb-3">
                      <div class="row">
                        <div class="col-6">
                          <small class="text-muted d-block">Válido desde:</small>
                          <strong>{{ formatarData(contrato.validFrom) }}</strong>
                        </div>
                        <div class="col-6">
                          <small class="text-muted d-block">Válido até:</small>
                          <strong *ngIf="contrato.validTo; else semDataVencimento">
                            {{ formatarData(contrato.validTo) }}
                          </strong>
                          <ng-template #semDataVencimento>
                            <span class="text-muted">Sem data de vencimento</span>
                          </ng-template>
                        </div>
                      </div>
                    </div>

                    <!-- Botão para expandir detalhes -->
                    <button 
                      class="btn btn-outline-primary btn-sm w-100" 
                      (click)="toggleDetalhes(contrato.id)">
                      <i class="fas" [class.fa-chevron-down]="!isExpanded(contrato.id)" 
                         [class.fa-chevron-up]="isExpanded(contrato.id)"></i>
                      {{ isExpanded(contrato.id) ? 'Ocultar' : 'Ver' }} Detalhes
                    </button>

                  </div>

                  <!-- Detalhes expandidos -->
                  <div *ngIf="isExpanded(contrato.id)" class="card-footer bg-light">
                    <div class="row">
                      <div class="col-12 mb-3">
                        <h6 class="text-primary mb-2">
                          <i class="fas fa-file-alt me-2"></i>
                          Termos do Contrato
                        </h6>
                        <div class="p-3 bg-white rounded border">
                          <p class="mb-0 small">{{ contrato.terms }}</p>
                        </div>
                      </div>
                      
                      <div class="col-md-6">
                        <h6 class="text-primary mb-2">
                          <i class="fas fa-info-circle me-2"></i>
                          Informações Adicionais
                        </h6>
                        <ul class="list-unstyled small">
                          <li><strong>Criado em:</strong> {{ formatarData(contrato.createdAt) }}</li>
                          <li *ngIf="contrato.createdByName">
                            <strong>Criado por:</strong> {{ contrato.createdByName }}
                          </li>
                          <li *ngIf="contrato.approvedAt">
                            <strong>Aprovado em:</strong> {{ formatarData(contrato.approvedAt) }}
                          </li>
                          <li *ngIf="contrato.approvedByName">
                            <strong>Aprovado por:</strong> {{ contrato.approvedByName }}
                          </li>
                        </ul>
                      </div>
                      
                      <div class="col-md-6">
                        <h6 class="text-primary mb-2">
                          <i class="fas fa-chart-line me-2"></i>
                          Status do Contrato
                        </h6>
                        <div class="d-flex align-items-center mb-2">
                          <i class="fas fa-circle text-success me-2" style="font-size: 0.5rem;"></i>
                          <span class="small">Contrato ativo e válido</span>
                        </div>
                        <div *ngIf="isProximoVencimento(contrato)" class="d-flex align-items-center mb-2">
                          <i class="fas fa-circle text-warning me-2" style="font-size: 0.5rem;"></i>
                          <span class="small text-warning">Próximo ao vencimento (30 dias)</span>
                        </div>
                        <div class="d-flex align-items-center">
                          <i class="fas fa-circle text-info me-2" style="font-size: 0.5rem;"></i>
                          <span class="small">Pode ser usado para criar lotes</span>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>

            <!-- Informações adicionais -->
            <div class="row mt-4">
              <div class="col-12">
                <div class="alert alert-light border">
                  <h6 class="alert-heading">
                    <i class="fas fa-lightbulb me-2"></i>
                    Informações Importantes
                  </h6>
                  <ul class="mb-0 small">
                    <li>Estes são seus contratos ativos que podem ser usados para criar lotes</li>
                    <li>A taxa de comissão será aplicada sobre as vendas realizadas</li>
                    <li>Contratos próximos ao vencimento são destacados em amarelo</li>
                    <li>Para alterações nos contratos, entre em contato com a administração</li>
                  </ul>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>